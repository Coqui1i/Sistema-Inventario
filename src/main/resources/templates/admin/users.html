<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:lang="${#locale.language}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="#{admin.users.title}">Administración de Usuarios</title>

    <!-- BOOTSTRAP CSS -->
    <link rel="stylesheet" th:href="@{/bootstrap/css/bootstrap.min.css}">

    <!-- BOOTSTRAP ICONS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- CUSTOM BUTTONS CSS -->
    <link rel="stylesheet" th:href="@{/bootstrap/custom.css}">

    <style>

        .card {
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .table tbody tr {
            animation: fadeInRow 0.5s ease-out forwards;
            opacity: 0;
        }
        
        @keyframes fadeInRow {
            to { opacity: 1; }
        }
        
        .table tbody tr:nth-child(1) { animation-delay: 0.1s; }
        .table tbody tr:nth-child(2) { animation-delay: 0.2s; }
        .table tbody tr:nth-child(3) { animation-delay: 0.3s; }
        .table tbody tr:nth-child(4) { animation-delay: 0.4s; }
        .table tbody tr:nth-child(5) { animation-delay: 0.5s; }
        
        .btn-purple {
            transition: all 0.3s ease;
        }
        
        .btn-purple:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .modal-content {
            animation: modalFadeIn 0.3s ease-out;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .badge {
            transition: all 0.2s ease;
        }
        
        .badge:hover {
            transform: scale(1.05);
        }

    </style>
</head>
<body>

<!-- NAVBAR -->
<div th:replace="~{layouts/navbar :: content}"></div>

<div class="container mt-4">
    <h2 class="mb-4" th:text="#{admin.users.heading}">Administración de Usuarios</h2>
    
    <!-- Modal Editar Usuario -->
    <div class="modal fade" id="editUserModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form th:action="@{/users/update}" method="post">
                    <div class="modal-header">
                        <h5 class="modal-title" th:text="#{admin.users.edit.title}">Editar Usuario</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="#{action.close}"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" name="username" id="editUsername">
                        <div class="mb-3">
                            <label class="form-label" th:text="#{user.form.firstname}">Nombres</label>
                            <input type="text" class="form-control" name="firstName" id="editFirstName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label" th:text="#{user.form.lastname}">Apellidos</label>
                            <input type="text" class="form-control" name="lastName" id="editLastName" required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" th:text="#{action.cancel}">Cancelar</button>
                        <button type="submit" class="btn btn-purple" th:text="#{action.save}">Guardar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Confirmar Eliminación -->
    <div class="modal fade" id="deleteUserModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form th:action="@{/users/delete}" method="post">
                    <div class="modal-header">
                        <h5 class="modal-title" th:text="#{admin.users.delete.title}">Confirmar Eliminación</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="#{action.close}"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" name="username" id="deleteUsername">
                        <p th:text="#{admin.users.delete.confirmation}">¿Estás seguro que deseas eliminar este usuario?</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" th:text="#{action.cancel}">Cancelar</button>
                        <button type="submit" class="btn btn-danger" th:text="#{action.delete}">Eliminar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header bg-purple-header">
            <h4 class="mb-0" th:text="#{admin.users.list.title}">Lista de Usuarios</h4>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover table-purple">
                    <thead>
                        <tr>
                            <th th:text="#{user.list.id}">ID</th>
                            <th th:text="#{user.list.username}">Nombre de Usuario</th>
                            <th th:text="#{user.list.firstname}">Nombres</th>
                            <th th:text="#{user.list.lastname}">Apellidos</th>
                            <th th:text="#{user.list.roles}">Roles</th>
                            <th th:text="#{user.list.actions}">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="user : ${users}">
                            <td th:text="${user.id}"></td>
                            <td th:text="${user.username}"></td>
                            <td th:text="${user.firstName}"></td>
                            <td th:text="${user.lastName}"></td>
                            <td>
                                <span th:each="role : ${user.roles}" class="badge bg-secondary me-1" th:text="${role.name}"></span>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-primary me-1" data-bs-toggle="modal" data-bs-target="#editUserModal"
                                    th:attr="data-username=${user.username}, data-firstname=${user.firstName}, data-lastname=${user.lastName}"
                                    aria-label="#{action.edit}">
                                    <i class="bi bi-pencil" aria-hidden="true"></i>
                                </button>
                                <button class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#deleteUserModal"
                                    th:attr="data-username=${user.username}"
                                    aria-label="#{action.delete}">
                                    <i class="bi bi-trash" aria-hidden="true"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- BOOTSTRAP JS -->
<script th:src="@{/bootstrap/js/bootstrap.bundle.min.js}"></script>

<script>

    // Script para cargar datos en el modal de edición
    document.getElementById('editUserModal').addEventListener('show.bs.modal', function (event) {
        const button = event.relatedTarget;
        document.getElementById('editUsername').value = button.getAttribute('data-username');
        document.getElementById('editFirstName').value = button.getAttribute('data-firstname');
        document.getElementById('editLastName').value = button.getAttribute('data-lastname');
    });

    // Script para cargar datos en el modal de eliminación
    document.getElementById('deleteUserModal').addEventListener('show.bs.modal', function (event) {
        const button = event.relatedTarget;
        document.getElementById('deleteUsername').value = button.getAttribute('data-username');
    });

</script>

</body>
</html>
